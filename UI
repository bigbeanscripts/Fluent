local toggleGui = Instance.new("ScreenGui")
toggleGui.Name = "DuckyToggleGui"
toggleGui.ResetOnSpawn = false
toggleGui.DisplayOrder = 100
toggleGui.Parent = (RunService:IsStudio() and LocalPlayer:WaitForChild("PlayerGui") or CoreGui)

local toggleBtn = Instance.new("ImageButton")
local normalSize = UDim2.new(0, 150, 0, 150)
local pressedSize = UDim2.new(0, 135, 0, 135)

toggleBtn.Size = normalSize
toggleBtn.AnchorPoint = Vector2.new(1, 0)
toggleBtn.Position = UDim2.new(1, -10, 0, 10) 
toggleBtn.BackgroundTransparency = 1
toggleBtn.Image = "rbxassetid://116073591672187"
toggleBtn.Parent = toggleGui
toggleBtn.Active = true

local dragging, dragInput, mousePos, framePos

toggleBtn.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        mousePos = input.Position
        framePos = toggleBtn.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then dragging = false end
        end)
    end
end)

toggleBtn.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then dragInput = input end
end)

game:GetService("UserInputService").InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - mousePos
        toggleBtn.Position = UDim2.new(framePos.X.Scale, framePos.X.Offset + delta.X, framePos.Y.Scale, framePos.Y.Offset + delta.Y)
    end
end)

toggleBtn.MouseButton1Down:Connect(function()
    TweenService:Create(toggleBtn, TweenInfo.new(0.1), {Size = pressedSize, ImageColor3 = Color3.fromRGB(200, 200, 255)}):Play()
end)

toggleBtn.MouseButton1Up:Connect(function()
    TweenService:Create(toggleBtn, TweenInfo.new(0.15, Enum.EasingStyle.Back), {Size = normalSize, ImageColor3 = Color3.fromRGB(255, 255, 255)}):Play()
end)

toggleBtn.Activated:Connect(function()
    if Library.CurrentWindow then Library.CurrentWindow:Minimize() end
end)

task.spawn(function()
    while task.wait(0.5) do
        if Library.CurrentWindow and Library.CurrentWindow.Root then
            Library.CurrentWindow.Root.Destroying:Connect(function()
                if toggleGui then
                    toggleGui:Destroy()
                end
            end)
            break
        end
    end
end)

return Library
